#
# Makefile for XDIFile C library
#
#
AR = ar
CC = @CC@
CPP = @CPP@
MAKEINFO = @MAKEINFO@
PACKAGE = @PACKAGE@
RANLIB = @RANLIB@
SHELL = @SHELL@
LINK = @CC@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
LDFLAGS = @LDFLAGS@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@

# you shouldn't have to alter anything below this line
#---------------------------------
READER  = xdi_reader
LIBXDIF_STATIC   = libxdifile.a
LIBXDIF_SHARED = libxdifile.so
XDIHEADERS = strutil.h xdifile.h
XDIF_OBJ  = xdifile.o strutil.o
CCOPTS = ##  -arch i386 -arch x86_64
SHARED = $(CCOPTS) -shared
CC = gcc $(CCOPTS)
LINKXDIF = -L$(libdir) -L. -lxdifile

all: $(READER) $(LIBXDIF_STATIC) $(LIBXDIF_SHARED)

$(READER).o: $(READER).c

.PHONY: clean install default

default: $(READER)

strutil.o: strutil.h
xdifile.o: xdifile.h strutil.h

$(LIBXDIF_STATIC): $(XDIF_OBJ)
	@rm -f $@
	$(AR) cru $(LIBXDIF_STATIC) $(XDIF_OBJ)
	$(RANLIB) $(LIBXDIF_STATIC)

$(LIBXDIF_SHARED): $(XDIF_OBJ)
	@rm -f $@
	$(LINK) $(SHARED) -o $@ $(XDIF_OBJ)

$(READER): $(LIBXDIF_STATIC) $(READER).o
	$(LINK) -o $(READER)  $(READER).o $(LIBXDIF_STATIC)

clean :
	rm -f $(XDIF_OBJ) $(READER).o $(READER) $(LIBXDIF_STATIC) $(LIBXDIF_SHARED)

install: $(LIBXDIF_STATIC)  $(LIBXDIF_SHARED)
	cp -pr $(LIBXDIF_STATIC) $(libdir)/$(LIBXDIF_STATIC)
	cp -pr $(LIBXDIF_SHARED) $(libdir)/$(LIBXDIF_SHARED)
	cp -pr $(XDIHEADERS) $(includedir)
