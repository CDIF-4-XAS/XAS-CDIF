#
# Makefile for XDIFile C library
#
#
AR = ar
CC = @CC@
CPP = @CPP@
MAKEINFO = @MAKEINFO@
PACKAGE = @PACKAGE@
RANLIB = @RANLIB@
SHELL = @SHELL@
LINK = @CC@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
LDFLAGS = @LDFLAGS@
bindir = @bindir@
libdir = @libdir@

# you shouldn't have to alter anything below this line
#---------------------------------
EXAMPLE1  = xdi_example1
LIBXDIF_STATIC   = libxdifile.a
LIBXDIF_SHARED = libxdifile.so
XDIF_OBJ  = xdifile.o strutil.o
CCOPTS = -arch i386 -arch x86_64
SHARED = $(CCOPTS) -shared
CC = gcc $(CCOPTS)
LINKXDIF = -L$(libdir) -L. -lxdifile

all: $(EXAMPLE1) $(LIBXDIF_STATIC) $(LIBXDIF_SHARED)

$(EXAMPLE1).o: $(EXAMPLE1).c

.PHONY: clean install default

default: $(EXAMPLE1)

strutil.o: strutil.h
xdifile.o: xdifile.h xdi_tokens.h strutil.h

$(LIBXDIF_STATIC): $(XDIF_OBJ)
	@rm -f $@
	$(AR) cru $(LIBXDIF_STATIC) $(XDIF_OBJ)
	$(RANLIB) $(LIBXDIF_STATIC)

$(LIBXDIF_SHARED): $(XDIF_OBJ)
	@rm -f $@
	$(LINK) $(SHARED) -o $@ $(XDIF_OBJ)

$(EXAMPLE1): $(LIBXDIF_SHARED) $(EXAMPLE1).o
	$(LINK) -o $(EXAMPLE1)  $(EXAMPLE1).o $(LIBXDIF_SHARED)

clean :
	rm -f $(XDIF_OBJ) $(EXAMPLE1).o $(EXAMPLE1) $(LIBXDIF_STATIC) $(LIBXDIF_SHARED)

install: $(LIBXDIF_STATIC)  $(LIBXDIF_SHARED)
	cp -pr $(LIBXDIF_STATIC) $(libdir)/$(LIBXDIF_STATIC)
	cp -pr $(LIBXDIF_SHARED) $(libdir)/$(LIBXDIF_SHARED)
